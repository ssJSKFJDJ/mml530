		mml2mid脱の悸赋弄プリプロセッサ v1.02

						nide@ics.nara-wu.ac.jp

  塑墒は、perl咐胳で今かれたmml2mid脱のプリプロセッサです。蝗脱にはperl
(矢机误に泣塑胳を蝗っているMMLファイルを借妄する眷圭にはjperl)が涩妥です。
  海のところ、悸附できているのは墓い叹涟のマクロˇ苞眶つきマクロだけです。
mml2mid塑挛で悸附するには络升な猖陇が涩妥なので、悸赋弄にプリプロセッサ
で悸附してみました。
  答塑弄な蝗い数は、墓い叹涟の/苞眶つきのマクロを蝗ったMMLファイルをa.mml
として

	jperl mmlpp.pl a.mml > b.mml

とすると、マクロを鸥倡してmml2midで借妄できるようになったMMLファイルが
b.mmlに掐りますので、それをmml2midで借妄する、といった恶圭です。(拒しく
は2鞠)
  v1.02では、メモル(等录未搂)さんによるピッチベンド猛纷换怠墙が烧裁され
ました(ありがとうございます)。これについて拒しくは、メモルさんによる
mmlppbnd.txtを徊救して布さい。

  掐蜗ファイル链挛をメモリに粕み哈んで借妄するので、DOSで蝗う眷圭はgo32
惹perlなど、驴翁のメモリを蝗える惹のperlを蝗って布さい。リアルモ〖ド惹で
は悸脱にはならないと蛔います。
  また、剩花な赖惮山附などでメモリをどんどん咯う(と蛔う)ので、Windowsの
ような稍奥年なシステムでちゃんと瓢侯しなくても勒扦は砷えません(UNIX惧の
perl5笆嘲では浇尸な瓢侯澄千をしていません)。
  perlは侍庞掐缄して布さい。perl5笆惧を夸京します。附哼の惹はperl4.036で
も办炳瓢くように侯ったつもりではありますが、侯荚の倡券茨董はperl5に败乖
しているので、经丸の惹はperl5でしか赖撅瓢侯しなくなるかも梦れません。


≮1≯mmlpp.plで钓される矢恕

√1.1⊥塑丸のmml2midの矢恕との惧疤高垂拉

  塑mmlpp.plが豺坚するMMLファイルの矢恕は、mml2midの窗链な橙磨になるよう
に侯られています。つまり、mml2midの矢恕にきちんと骄っているMMLファイルな
ら、それをmmlpp.plにかけた稿mml2midで借妄しても、mml2midだけで借妄するの
と票じ冯蔡が评られるはずです(そうならなければバグ)。


√1.2⊥墓い叹涟のマクロの蝗脱

  mml2midに孺べ、マクロ年盗乖の矢恕が橙磨されています。

	${マクロ叹} マクロ年盗

という乖が今けます。マクロ叹は、毖眶机と≈_∽からなる扦罢の叹涟です(络矢
机井矢机は惰侍されます)。また、年盗されたマクロを蝗脱する狠にも

	${マクロ叹}

という淡揭が蝗えます。
  毋えば、肌のMMLファイル

	${macro1} cde2
	A l4 ${macro1} ${macro1} gedc ded2

は、

	A l4 cde2 cde2 gedc ded2

に鸥倡されます。
  泼毋として、マクロ叹が毖井矢机1机だけ、あるいは眶机1机+毖井矢机1机だけ
の眷圭は、マクロ叹を跋む≈{}∽を维しても票じ罢蹋になります(mml2mid极挛の
 マクロの怠墙と票じ今き数になるわけです)。毋えば

	${0a} cde2

と

	$0a cde2

は票じ罢蹋です。マクロを蝗う箕にも≈${0a}∽と≈$0a∽は票じ罢蹋です。


√1.3⊥苞眶つきマクロの蝗脱

  苞眶つきマクロを年盗するには、マクロ年盗の塑挛の面に≈#戎规∽と今いて
おき、マクロを蝗脱する箕に≈${マクロ叹:苞眶1,苞眶2,∧,苞眶n}∽のように今
きます。すると、マクロ鸥倡箕に、≈#i∽に苞眶iが虽め哈まれます。
  毋えば、肌のMMLファイル

	${macro1} [cg#1#2]4
	A l16 ${macro1:>c,d<} ${macro1:>e,<g}

は

	A l16 [cg>cd<]4 [cg>e<g]4

に鸥倡されます。マクロmacro1の呵介の钙び叫しでは妈1苞眶が≈>c∽で妈2苞眶
が≈d<∽、2刨誊の钙び叫しでは妈1苞眶が≈>e∽で妈2苞眶が≈g<∽になってお
り、これがマクロ鸥倡箕にそれぞれ≈#1∽≈#2∽の疤弥に虽め哈まれたわけです。
  いくつか庙罢爬があります。

  (1) 苞眶つきマクロを钙び叫す狠は、たとえマクロの叹涟が毖井矢机1机だけ、
あるいは眶机1机+毖井矢机1机だけであっても、链挛を≈{ }∽で跋んで布さい。
毋えば

	${0a} [cg#1#2]4
	A l16 ${0a:>c,d<} ${0a:>e,<g}

の洛わりに

	${0a} [cg#1#2]4
	A l16 $0a:>c,d< $0a:>e,<g

とは今けません。ただしマクロの年盗乖にはこの扩嘎はないので、マクロの叹涟
が毖井矢机1机か眶机1机+毖井矢机1机である眷圭の

	$0a [cg#1#2]4
	A l16 ${0a:>c,d<} ${0a:>e,<g}

はOKです。

  (2) 10改笆惧の苞眶を燃うマクロを年盗する眷圭は、≈#10∽ではなく≈#{10}∽
のように苞眶の戎规を≈{ }∽で跋んで布さい。≈#10∽だと、1戎誊の苞眶に0を
つなげたものと豺坚されてしまいます。

  (3) マクロ钙び叫し箕に≈,∽を崔む苞眶を回年したい眷圭、そのままでは≈,∽
が苞眶の惰磊りと豺坚されてしまいますので、≈\,∽と回年して布さい。毋えば

	$a FE3,#1,#2
	A E127 ${a:0,8\,-50\,2.\,50}

は、妈1苞眶が≈0∽、妈2苞眶が≈8,-50,2.,50∽ということになるので

	A E127 FE3,0,8,-50,2.,50

に鸥倡されます。

  ただし、≈{ }∽を崔む苞眶の眷圭、その面の≈,∽は≈\,∽と淡揭しなくても
络炬勺です。毋えば

	$a EX x41,x10,x42,x12,#1,xf7
	A ${a:{x40,x01,x30,x00}}

の眷圭、妈1苞眶は≈{x40,x01,x30,x00}∽になるため

	A EX x41,x10,x42,x12,{x40,x01,x30,x00},xf7

に鸥倡されます。

  また、≈\∽を苞眶に崔めたい眷圭も≈\\∽と淡揭して布さい(mml2mid.txtに
よると≈\不墓∽炭吾はobsoleteですが)。办忍に、マクロ钙び叫し箕の苞眶面の
∝≈\∽+1矢机≠は、≈\∽が琼ぎ艰られて、その肌の矢机そのものとして胺われ
ます(矢机误柒を近く)。

  (4) マクロの苞眶の改眶のチェックは乖っていません。毋えば

	$a cde#1#2
	A ${a:f,g,a}

は、苞眶2改のマクロ年盗に滦し3改の苞眶を涂えていますが、エラ〖にはならず、
妈3苞眶は帽に嘉てられるだけです。嫡に

	$a cde#1#2#3
	A ${a:f,g}

のように、苞眶3改のマクロ年盗に滦し2改しか苞眶を涂えない眷圭もエラ〖は叫
ず、≈#3∽には鄂の苞眶が虽められて≈A cdefg∽に鸥倡されます。


√1.4⊥ピッチベンド猛纷换怠墙

  BS, FB, UBなどのコマンドで、ピッチベンド猛を染不帽疤で回年できる怠墙で
す。mmlppbnd.txtを徊救して布さい。


√1.5⊥庙罢祸灌

  [a] mmlpp.plはマクロ鸥倡の戮に、#includeの鸥倡も塑丸のmml2midと票屯に
乖います。さもないと、includeされるファイルの面でのマクロ年盗が跟かない
からです。また、コメントの近殿、费鲁乖を1乖につなげるなどの拎侯も、塑丸
のmml2midと票屯に乖います。

  [b] 票叹のマクロが2刨年盗されていてもエラ〖にはならず、稿の年盗が铜跟
になります。
  また、マクロの蝗脱はマクロの年盗より黎でも稿でもかまいません。塑丸の
mml2midと佰なり、マクロ年盗の面でさらにマクロが蝗われている眷圭にも、マ
クロの年盗が蝗脱より稿でもOKです。

  [c] 塑丸のmml2midでは、マクロ柒のル〖プの鸥倡はマクロの年盗箕に乖われ
ています。骄って、mml2midではマクロ柒のル〖プはマクロ柒で窗冯(帆り手し搀
眶も崔めて)していなければなりません。毋えば≈cde∽を4搀帆り手すつもりで
疙って

	/* これはmml2midでは疙り */
	$a [cde]
	A $a4

と今くと、≈[cde]∽のル〖プの鸥倡はマクロの年盗箕に乖われ(帆り手し搀眶が
维されているので2搀帆り手しとなり)、$aの年盗柒推は≈cdecde∽となります。
骄って、マクロの鸥倡冯蔡は≈cdecde4∽となり、罢哭と佰なってしまいます。
  しかしmmlpp.plを蝗う眷圭は、マクロの鸥倡が黎に乖われ、その稿でmml2mid
がル〖プの鸥倡をします。骄って、マクロの鸥倡冯蔡は≈[cde]4∽となり、
mml2midがル〖プの鸥倡を乖って、赖しい遍琳が乖われます。
  このように、マクロ柒のル〖プがマクロ柒で窗冯している涩妥がなくなるわけ
です。

  [d] mml2midと票屯に、矢机误柒ではたとえ≈$∽が附れてもマクロの鸥倡は乖
われません。毋えば

	$a violin
	A C1"1st.$a" @40 cde

とかやっても≈A C1"1st.violin" @40 cde∽には鸥倡されません。これに陵碰す
ることをしたければ、mml2midの矢机误息儡怠墙を蝗って布さい。毋えば

	$a "violin"
	A C1"1st."+$a @40 cde

とすると≈A C1"1st"+"violin" @40 cde∽に鸥倡され、mml2midが矢机误を息儡
して≈1st.violin∽をトラック叹に肋年します。


≮2≯mmlpp.plの蝗脱恕

  mmlpp.plの蝗い数は

	perl mmlpp.pl MMLファイル	
	  あるいは
	perl mmlpp.pl

です。ファイル叹苞眶を剩眶今くことはできません。ファイル叹を涂えなかった
眷圭は筛洁掐蜗を粕みます。また、叫蜗は筛洁叫蜗に叫ますので、それをファイ
ルに呈羌したい眷圭は

	perl mmlpp.pl MMLファイル > 叫蜗黎

のようにリダイレクトして布さい。
  前のため今いておきますと、mmlppはあくまでプリプロセッサですので、MIDI
ファイルの侯喇をしたければ、mmlppの叫蜗をファイルに呈羌したうえで、その
ファイルを猖めてmml2midでコンパイルして布さい。

  矢机误に泣塑胳を崔むMMLファイルの眷圭は、jperlを脱罢して

	jperl -Leuc mmlpp.pl MMLファイル > 叫蜗黎	(泣塑胳EUCの眷圭)
	jperl -Lsjis mmlpp.pl MMLファイル > 叫蜗黎	(MS戳机コ〖ドの眷圭)

として布さい。润泣塑胳perlだと≈山∽とか≈ソ∽とかが矢机误柒に附れた眷圭
に赖撅に借妄できない眷圭があります。
  芒し、jperlのデフォルトの矢机コ〖ドと票じ眷圭には≈-Leuc∽または
≈-Lsjis∽は臼维できます。毋えばDOSの眷圭、芹邵されているjperlはデフォル
トがMS戳机コ〖ドでしょうから、MS戳机コ〖ドのMMLファイルを借妄するなら

	jperl mmlpp.pl MMLファイル > 叫蜗黎

で颅ります。

  DOSでは笆布のバッチを侯っておくと守网かも梦れません。

	@echo off
	jperl mmlpp.pl %1 > tmp.mml
	mml2mid tmp.mml %2 %3 %4 %5 %6 %7 %8 %9
	del tmp.mml

このバッチの叹涟をmml2midx.batだとして、毋えば

	C:\> mml2midx a.mml a.mid -f -t1 -x

のようにすると、a.mmlをmmlpp.plで借妄してmml2midでコンパイル(format0で叫
蜗、染不尸败拇、≈>∽と≈<∽を掐れ垂え)し、冯蔡をa.midに掐れます。

  mmlpp.plを帽迫のコマンドにしたい(つまり、perlと汤绩弄に虑たなくても
≈mmlpp MMLファイル叹∽でいけるようにしたい)眷圭、DOSでは≈SOS∽(ftp:
//ftp.ics.nara-wu.ac.jp/pub/nide/dosutil/sos110d.tgz)の网脱を浮皮して布
さい。UNIXの眷圭は揭べるまでもないでしょう。


≮3≯构糠旺悟
  99/7/26 v1.00
      ˇ介惹
  00/6/18 v1.01
      ˇ#includeするファイル叹面に≈\v∽がある眷圭と、≈\x∽があってその
	肌の16渴眶のa×fが络矢机で淡揭されている眷圭に、mml2midと佰なる
	豺坚をしていたのを柠赖
  01/1/20 v1.02
      ˇメモル(等录未搂)さんによるピッチベンド猛纷换怠墙烧裁。
